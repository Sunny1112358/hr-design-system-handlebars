(window.webpackJsonpardplayer=window.webpackJsonpardplayer||[]).push([[3],{543:function(e,t,a){"use strict";a.r(t);var i=a(502),r=a(169),s=a.n(r),n=a(8),l=a(28),o=a(7),d=a(4),h=a(0),m=a(2);class c extends i.a{constructor(){super(...arguments),this.lastState="",this.currentMediaStream=null,this.currentTime=0,this.dvrTime=0,this.dvrLeft=0,this.dvrRight=0}get castAddon(){var e;return null!==(e=this.player.addons.find((e=>"AddonChromecast"===e.ID)))&&void 0!==e?e:null}removeEventListeners(){super.removeEventListeners(),this.vc.forceControlsVisible=!1,this.vc.playerView.classList.remove("ardplayer-state-casting")}addEventListeners(){this._dvrModeEnabled=!1,this._dvrWindow=0,this._dvrIsLive=!1,this.dvrTime=-1,this.vc.forceControlsVisible=!0,this.vc.playerView.classList.add("ardplayer-state-casting");const e=this.castAddon;this.remotePlayer=e.remotePlayer,this.remotePlayerController=e.remotePlayerController,this.emap=new s.a,this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,this.onTimeUpdate,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,this.onStateChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED,this.onDurationChange,this),this.emap.map(this.remotePlayerController,cast.framework.RemotePlayerEventType.LIVE_SEEKABLE_RANGE_CHANGED,this.onLiveSeekableRangeChanged,this),this.emap.map(this.player,d.a.SUPER_SUBTITLE_ACTIVATION,this.onSubtitleActivation,this),this.emap.map(this.player,d.a.SUPER_SUBTITLE_DEACTIVATION,this.onSubtitleDeactivation,this)}onStateChange(e){switch(this.log("statechange",e.value),e.value){case"PLAYING":this.onPlay();break;case"PAUSED":this.onPause(null);break;case"BUFFERING":this.bufferingEventHandler(!0);break;case"IDLE":"PLAYING"===this.lastState&&this.endEventHandler(null)}this.lastState=e.value}restartMedia(){null!==this.currentMediaStream&&this.loadStream(this.currentMediaStream)}setVolume(e,t=!1){e>=0&&e<=100&&(t||n.a.setVolume(this.player,e),this.remotePlayer&&this.remotePlayerController&&(this.remotePlayer.volumeLevel=e/100,this.remotePlayerController.setVolumeLevel()))}setMuted(e,t=!1){this.remotePlayer&&this.remotePlayerController&&this.remotePlayer.isMuted!==e&&this.remotePlayerController.muteOrUnmute(),t||n.a.setMuted(this.player,e)}onDurationChange(e){this._duration=e.value,this._ready=!0}getDuration(){return this._dvrModeEnabled?this._dvrWindow:this._duration}onTimeUpdate(e){this.currentTime=e.value}getCurrentTime(){var e,t,a;return this._pendingSeek>0?this._pendingSeek:this._dvrModeEnabled?this.dvrTime:null!==(a=null!==(t=null===(e=this.remotePlayer)||void 0===e?void 0:e.currentTime)&&void 0!==t?t:this.currentTime)&&void 0!==a?a:0}onLiveSeekableRangeChanged(e){var t,a;this._dvrModeEnabled=e.value&&e.value.end>0,e.value&&(this.dvrLeft=e.value.start,this.dvrRight=e.value.end),this._dvrWindow=this.dvrRight-this.dvrLeft,this.dvrTime=(null!==(a=null===(t=this.remotePlayer)||void 0===t?void 0:t.currentTime)&&void 0!==a?a:0)-this.dvrLeft,this.updateDVRValues()}updateDVRValues(){this._dvrIsLive=this.currentTime>=this.getDuration(),this.onDVRCallback(this._dvrModeEnabled,this._dvrWindow,this._dvrIsLive)}play(){var e;null===(e=this.remotePlayerController)||void 0===e||e.playOrPause()}pause(){var e;null===(e=this.remotePlayerController)||void 0===e||e.playOrPause()}loadStream(e){var t,a,i,r,s,d,c,u,v,p,y,T,S,g,E;this.log("loadStream()"),this.player.viewCtrl.hidePosterFrame(),this.model.playstate=l.a.PLAYSTATE_UNSPECIFIED,this.currentMediaStream=e;const b=this.mc.isLive;if(this.stopOtherPlayingPlayers(),this.player.loop.dispatchEvent(o.a.EVENT_LOAD_STREAM,{mediaStream:e}),this._pendingSeek=this.model.time,!this._pendingSeek&&!this.mc.isLive){let e=this.pc.generic.vodInitialPlayheadSeconds;e<=0&&(e=this.pc.generic.vodStartSeconds),this._pendingSeek=e}const C=[];this.mc.subtitles.map((e=>Object.assign({},e,{sources:e.sources.find((e=>"webvtt"===e.kind))}))).filter((e=>{var t,a;return(null!==(a=null===(t=e.sources)||void 0===t?void 0:t.length)&&void 0!==a?a:0)>0})).forEach(((e,t)=>{var a;const i=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);let r=String(null!==(a=e.sources[0].url)&&void 0!==a?a:"");r.startsWith("//")&&(r=`https:${r}`),i.trackContentId=r,i.trackContentType="text/vtt",i.subtype=chrome.cast.media.TextTrackType.SUBTITLES,i.name=`${Object(h.e)(e.languageCode)}${"simple-language"===e.kind?" - Einfache Sprache":""}`,i.language=e.languageCode,i.customData={},C.push(i)}));const P=new chrome.cast.media.MediaInfo(e.url,e.mimeType);P.tracks=C,P.streamType=b?chrome.cast.media.StreamType.LIVE:chrome.cast.media.StreamType.BUFFERED,P.duration=b?-1:null!==(t=this.mc.meta.durationSeconds)&&void 0!==t?t:0,this.player.isAudio?(P.metadata=new chrome.cast.media.MusicTrackMediaMetadata,P.metadata.songName=null!==(a=this.mc.meta.title)&&void 0!==a?a:"",P.metadata.title=null!==(i=this.mc.meta.title)&&void 0!==i?i:"",P.metadata.albumName=null!==(d=null!==(s=null!==(r=this.mc.meta.seriesTitle)&&void 0!==r?r:this.mc.meta.subHeading)&&void 0!==s?s:this.mc.meta.synopsis)&&void 0!==d?d:"",Object(h.k)(null===(c=this.mc.meta.publicationService)||void 0===c?void 0:c.name)||(P.metadata.albumArtist=null===(u=this.mc.meta.publicationService)||void 0===u?void 0:u.name),Object(h.k)(this.mc.meta.broadcastedOnDateTime)||(P.metadata.releaseDate=this.mc.meta.broadcastedOnDateTime)):(P.metadata=new chrome.cast.media.MovieMediaMetadata,P.metadata.title=null!==(v=this.mc.meta.title)&&void 0!==v?v:"",P.metadata.subtitle=null!==(T=null!==(y=null!==(p=this.mc.meta.seriesTitle)&&void 0!==p?p:this.mc.meta.subHeading)&&void 0!==y?y:this.mc.meta.synopsis)&&void 0!==T?T:"",Object(h.k)(null===(S=this.mc.meta.publicationService)||void 0===S?void 0:S.name)||(P.metadata.studio=null===(g=this.mc.meta.publicationService)||void 0===g?void 0:g.name),Object(h.k)(this.mc.meta.broadcastedOnDateTime)||(P.metadata.releaseDate=this.mc.meta.broadcastedOnDateTime)),P.metadata.images=this.mc.meta.images.map((e=>({url:new URL(e.url,document.baseURI).href})));const k=new chrome.cast.media.LoadRequest(P);null===(E=cast.framework.CastContext.getInstance().getCurrentSession())||void 0===E||E.loadMedia(k).then((()=>{try{this.player.checkState()}catch(e){return void m.g.warn("aborting async",e)}n.a.subtitleEnabled(this.player)&&this.setSubtitles(!0),this._ready=!0,this.evalInitialSeek()}),(()=>m.g.error))}onSubtitleActivation(){this.setSubtitles(!0)}onSubtitleDeactivation(){this.setSubtitles(!1)}setSubtitles(e){var t;try{const a=null===(t=cast.framework.CastContext.getInstance().getCurrentSession())||void 0===t?void 0:t.getMediaSession(),i=e?[0]:[],r=new chrome.cast.media.EditTracksInfoRequest(i);null==a||a.editTracksInfo(r,(()=>{}),(()=>m.g.error))}catch(e){m.g.error(e)}}setCurrentTime(e,t=!1,a=!1,i=!1){if(this.remotePlayer&&this.remotePlayerController&&this.remotePlayer.canSeek){let a=Math.min(e,this.getDuration()-.1);this._dvrModeEnabled&&(a=this.dvrLeft+e,this.dvrTime=e),this.remotePlayer.currentTime=a,this.remotePlayerController.seek(),this.onStateChange({value:"BUFFERING"}),super.setCurrentTime(e,t,!0,i)}}updateTicker(){if(this._dvrModeEnabled)switch(this.model.playstate){case l.a.PLAYSTATE_PAUSED:case l.a.PLAYSTATE_PLAYING:this.dvrLeft+=.5,this.dvrRight+=.5}super.updateTicker()}canSeek(){return!0}getClassTypeString(){return"ChromecastCtrl"}addSource(e){m.g.warn("addSource not implemented for Chromecast.")}}var u=c;const v={Generator:a(503).a,Controller:u};t.default=v}}]);